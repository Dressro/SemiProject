<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.fp.board">

	<select id="board_selectList" parameterType="BoardDto" resultType="BoardDto">
		select
		board_no,board_free_no,board_notice_no,board_qna_no,board_dec_no,
		board_title,board_content,board_regdate,board_readcount,
		board_groupno,board_groupseq,board_titletab,member_id
		from board 
		where board_category=#{board_category}
		and board_title=#{board_title}
		and board_content=#{board_content}
		and member_id=#{member_id}
		order by board_no desc
		
		
	</select>
	<select id="free_selectList" resultType="BoardDto">
		select
		b.board_no,b.board_free_no,b.board_notice_no,b.board_qna_no,b.board_dec_no,
		b.board_title,b.board_content,b.board_regdate,b.board_readcount,
		b.board_groupno,b.board_groupseq,b.board_titletab,m.member_nicname as member_id
		from board b,member m
		where board_category='F'
		and b.member_id = m.member_id
		order by board_groupno desc , board_groupseq
	</select>

	<select id="free_allCount" resultType="int">
		SELECT COUNT(BOARD_FREE_NO) AS cnt
		FROM BOARD
		WHERE BOARD_CATEGORY = 'F'
	</select>

	<select id="notice_allCount" resultType="int">
		SELECT COUNT(BOARD_NOTICE_NO) AS cnt
		FROM BOARD
		WHERE BOARD_CATEGORY = 'N'
	</select>
	
	<select id="qna_allCount" resultType="int">
		SELECT COUNT(BOARD_QNA_NO) AS cnt
		FROM BOARD
		WHERE BOARD_CATEGORY = 'Q'
	</select>
	
	<select id="dec_allCount" resultType="int">
		SELECT COUNT(BOARD_DEC_NO) AS cnt
		FROM BOARD
		WHERE BOARD_CATEGORY = 'D'
	</select>


	<select id="free_selectList" parameterType="com.project.fp.dto.PagingDto" resultType="BoardDto">
		 SELECT X.*
	     FROM (
	     SELECT ROWNUM AS rnum, A.*
	     FROM (
	     SELECT BOARD_FREE_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_REGDATE, BOARD_READCOUNT, BOARD_GROUPNO, BOARD_GROUPSEQ, BOARD_TITLETAB, BOARD_CATEGORY
	     FROM BOARD
	     WHERE BOARD_CATEGORY = 'F'
	     ORDER BY BOARD_REGDATE DESC
	     ) A
	     WHERE ROWNUM <![CDATA[ <= ]]> #{blockEnd}
		   ) X
	     WHERE X.rnum <![CDATA[ >= ]]> #{blockBegin}
	</select>
	
	<select id="notice_selectList" parameterType="com.project.fp.dto.PagingDto" resultType="BoardDto">
		 SELECT X.*
	     FROM (
	     SELECT ROWNUM AS rnum, A.*
	     FROM (
	     SELECT BOARD_NOTICE_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_REGDATE, BOARD_READCOUNT, BOARD_GROUPNO, BOARD_GROUPSEQ, BOARD_TITLETAB, BOARD_CATEGORY
	     FROM BOARD
	     WHERE BOARD_CATEGORY = 'N'
	     ORDER BY BOARD_REGDATE DESC
	     ) A
	     WHERE ROWNUM <![CDATA[ <= ]]> #{blockEnd}
		   ) X
	     WHERE X.rnum <![CDATA[ >= ]]> #{blockBegin}
	</select>
	
	<select id="qna_selectList" parameterType="com.project.fp.dto.PagingDto" resultType="BoardDto">
		 SELECT X.*
	     FROM (
	     SELECT ROWNUM AS rnum, A.*
	     FROM (
	     SELECT BOARD_QNA_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_REGDATE, BOARD_READCOUNT, BOARD_GROUPNO, BOARD_GROUPSEQ, BOARD_TITLETAB, BOARD_CATEGORY
	     FROM BOARD
	     WHERE BOARD_CATEGORY = 'Q'
	     ORDER BY BOARD_REGDATE DESC
	     ) A
	     WHERE ROWNUM <![CDATA[ <= ]]> #{blockEnd}
		   ) X
	     WHERE X.rnum <![CDATA[ >= ]]> #{blockBegin}
	</select>
	
	<select id="dec_selectList" parameterType="com.project.fp.dto.PagingDto" resultType="BoardDto">
		 SELECT X.*
	     FROM (
	     SELECT ROWNUM AS rnum, A.*
	     FROM (
	     SELECT BOARD_DEC_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_REGDATE, BOARD_READCOUNT, BOARD_GROUPNO, BOARD_GROUPSEQ, BOARD_TITLETAB, BOARD_CATEGORY
	     FROM BOARD
	     WHERE BOARD_CATEGORY = 'D'
	     ORDER BY BOARD_REGDATE DESC
	     ) A
	     WHERE ROWNUM <![CDATA[ <= ]]> #{blockEnd}
		   ) X
	     WHERE X.rnum <![CDATA[ >= ]]> #{blockBegin}
	</select>

	<select id="board_selectOne" parameterType="int" resultType="BoardDto">
		select
		b.board_no,b.board_free_no,b.board_notice_no,b.board_qna_no,b.board_dec_no,
		board_title,b.board_content,b.board_regdate,b.board_readcount,
		b.board_groupno,b.board_groupseq,b.board_titletab,b.board_category,m.member_nicname as member_id
		from board b, member m
		where b.board_no = #{board_no}
		and b.member_id = m.member_id
	</select>
	
	<insert id="free_insert" parameterType="BoardDto">
		insert into board
		values
		(board_no_seq.nextval,board_free_no_seq.nextval,null,null,null,#{board_title},
		#{board_content},sysdate,0,board_groupno_seq.nextval,1,0,'N',#{board_category},#{member_id})
	</insert>
	<insert id="notice_insert" parameterType="BoardDto">
		insert into board
		values
		(board_no_seq.nextval,null,board_notice_no_seq.nextval,null,null,#{board_title},
		#{board_content},sysdate,0,0,0,0,'N',#{board_category},#{member_id})
	</insert>
	<insert id="qna_insert" parameterType="BoardDto">
		insert into board
		values
		(board_no_seq.nextval,null,null,board_qna_no_seq.nextval,null,#{board_title},
		#{board_content},sysdate,0,board_qna_groupno_seq.nextval,1,0,'N',#{board_category},#{member_id})
	</insert>
	<insert id="dec_insert" parameterType="BoardDto">
		insert into board
		values
		(board_no_seq.nextval,null,null,null,board_dec_no_seq.nextval,#{board_title},
		#{board_content},sysdate,0,0,0,0,'N',#{board_category},#{member_id})
	</insert>
	<insert id="free_answerinsert" parameterType="BoardDto">
		insert into board
		values
		(board_no_seq.nextval,board_free_no_seq.nextval,null,null,null,#{board_title},
		#{board_content},sysdate,0,
		(select board_groupno from board where board_free_no = #{board_free_no}),
		(select board_groupseq from board where board_free_no =
		#{board_free_no}) + 1,
		(select board_titletab from board where board_free_no = #{board_free_no}) +
		1,
		'N',#{board_category},#{member_id})
	</insert>
	<insert id="qna_answerinsert" parameterType="BoardDto">
		insert into board
		values
		(board_no_seq.nextval,null,null,board_qna_no_seq.nextval,null,#{board_title},
		#{board_content},sysdate,0,
		(select board_groupno from board where board_qna_no = #{board_qna_no}),
		(select board_groupseq from board where board_qna_no =
		#{board_qna_no}) + 1,
		(select board_titletab from board where board_qna_no = #{board_qna_no}) + 1,
		'N',#{board_category},#{member_id} )
	</insert>
	<update id="free_answerupdate" parameterType="int">
		update board set board_groupseq = board_groupseq + 1
		where board_groupno = (select board_groupno from board where board_free_no
		= #{board_free_no})
		and board_groupseq > (select board_groupseq from board where
		board_free_no = #{board_free_no})
		and board_category = 'F'
	</update>
	<update id="qna_answerupdate" parameterType="int">
		update board set board_groupseq = board_groupseq + 1
		where board_groupno = (select board_groupno from board where board_qna_no =
		#{board_qna_no})
		and board_groupseq > (select board_groupseq from board where board_qna_no
		= #{board_qna_no})
		and board_category = 'Q'
	</update>
	<update id="readcountupdate" parameterType="int">
		update board set board_readcount = board_readcount + 1
		where board_no = #{board_no}
	</update>
	<delete id="free_delete" parameterType="int">
		update board set board_delflag="Y"
		where board_category="F"
		and board_free_no = #{board_free_no}
	</delete>
	<delete id="delete" parameterType="int">
		delete from board
		where board_no = #{board_no}
	</delete>

</mapper>